<div (click)="closeDialog()" class="dialogBackground"
    *ngIf="addMemberDialogOpen || channelEditionDialogOpen || showMembersDialogOpen">
</div>

<div style="display: flex;">
    <div class="mainChatContainer" [ngClass]="{'mainChatFullWidth': !threadOpen}">
        <!-- ======================================== MAIN CHAT HEADER ========================================== -->
        @if(showChannel) {
        <!-- =========== TEMPLATE MAIN CHAT HEADER - CHANNELS ============= -->
        <div class="mainChatHeader">
            <div class="mainChatHeaderLeft" (click)="toggleDialog('channelEdition')">
                <div>&#35;</div>
                <div>{{channel?.name}}</div>
                <div>
                    <mat-icon class="material-symbols-outlined" fontIcon="keyboard_arrow_down"></mat-icon>
                </div>
            </div>

            <div class="mainChatHeaderRight">
                <div (click)="toggleDialog('showMembers')">
                    <div class="memberPhotos">
                        @for (member of channel?.members | slice:0:2; track $index) {
                        <div>
                            <img src="/assets/img/main-chat/member2.svg">
                        </div>
                        }
                    </div>
                    <div>{{channel?.members.length}}</div>
                </div>
                <div (click)="toggleDialog('addMember'); scrollToBottom()" >
                    <span class="material-symbols-outlined">person_add</span>
                </div>
            </div>

            <!--========== Channel Edition/ Dialog ============-->
            <app-channel-edition-dialog [channelData]="channel" [currentChannelId]="activeChannelId" *ngIf="channelEditionDialogOpen"
                (channelEditionDialogOpenChild)="setBoolean(channelEditionDialogOpen)"></app-channel-edition-dialog>
            <!--=================================================-->

            <!--============== Show member Dialog ================-->
            <app-show-members-dialog [channelData]="channel" [currentChannelId]="activeChannelId" *ngIf="showMembersDialogOpen"
                (addMembersDialogOpenOpenChildShow)="switchToAddMembers(addMemberDialogOpen)"
                (showMembersDialogOpenChild)="setBoolean(showMembersDialogOpen)"></app-show-members-dialog>
            <!--=================================================-->

            <!--========== Add member Dialog ============-->
            <app-add-members-dialog [channelData]="channel" [currentChannelId]="activeChannelId" *ngIf="addMemberDialogOpen"
                (addMemberDialogOpenChild)="setBoolean(addMemberDialogOpen)"></app-add-members-dialog>
            <!--=================================================-->

        </div>
        <!-- ================================================== -->
        } @else {
        <!-- =========== TEMPLATE MAIN CHAT HEADER - DM ============= -->
<!--         <div class="mainChatHeader">
            <div class="mainChatHeaderLeft">
                <div class="userImage">
                    <img src="/assets/img/main-chat/member2.svg">
                    <div class="onlineStatus" [ngClass]="{
                      online: users[1].onlineStatus === 'active',
                      idle: users[2].onlineStatus === 'idle',
                      busy: users[3].onlineStatus === 'busy',
                      away: users[0].onlineStatus === 'away'
                    }"></div>
                </div>
                <div>{{users[1].name}} {{users[1].surname}}</div>
            </div>
        </div> -->
        <!-- ========================================================== -->
        }
        <!-- ===================================================================================================== -->

        <!-- ======================================== MAIN CHAT MESSAGES ========================================== -->
        <div class="mainChatMessages" #mainChat>
<!--             <div class="mainChatMessagesSubContainer">
 -->            @if(showChannel) {
                <!-- =========== Template main chat beginning - Channel ============= -->
                <div class="beginningOfChannel">
                    <div>
                        <div>&#35;</div>
                        <div>{{channel?.name}}</div>
                    </div>
                    <div>
                        Du hast den Channel heute erstellt. Das ist der Anfang des Channels <span
                            style="color: rgba(83, 90, 241, 1)">#{{channel?.name}}</span>
                    </div>
                </div>
                <!-- ================================================================ -->
                } @else {
                <!-- =========== Template main chat beginning - DM ============= -->
<!--                 <div class="beginningOfChannel">
                    <div>
                        <div>
                            <img [src]="channel[0].members[0].photo">
                        </div>
                        <div>{{channel[0].members[0].name}}</div>
                    </div>
                    <div>
                        Diese Unterhaltung findet nur zwischen <span
                            style="color: rgba(83, 90, 241, 1)">&#64;{{channels[0].members[0].name}}
                            {{channels[0].members[0].surname}}</span> und dir statt.
                    </div>
                </div> -->
                <!-- ================================================================ -->
                }

                <!-- =================== Time separator / Threads ===================== -->
                 @for (threadCreationDate of threadCreationDates; track $index) {
                    <div class="timeSeparator">
                        <div>
                            <div>{{threadCreationDate.timeSeparatorDate}}</div>
                        </div>
                    </div>

                    @for (thread of channelThreadsDateTime; track $index) {
                        @if(thread.dateString == threadCreationDate.dateString) {
                            @if(currentUser !== thread.userId){
                                <!-- ========================= Template Other Messages ========================= -->
                                <div class="messageContainer">
                                    <div class="messageProfileIcon">
                                        <img src="/assets/img/main-chat/member1.svg">
                                    </div>
                                    <div class="mainMessage">
                                        <div>
                                            <div>{{thread.createdBy}}</div>
                                            <div>{{thread.time}} Uhr</div>
                                        </div>
                                        <div>
                                            {{thread.message}}
                                        </div>
                                        <div class="mainMessageThreads">
                                            <div (click)="openThread(thread.threadId)">2 Antworten</div>
                                            <div>Letzte Antwort 14:56</div>
                                        </div>
                                        <div class="mainThreadReactions">
                                            <div>
                                                <span class="material-symbols-outlined">add_reaction</span>
                                            </div>
                                            <div>
                                                <div class="ractionEmoji">
                                                     <img src="/assets/img/main-chat/rocketEmoji.svg">                                            </div>
                                                <div class="ractionCount">
                                                    <div>1</div>
                                                </div>
                                                <div class="reactionHoverBubble">
                                                    <div></div>
                                                    <div>Sofia MÃ¼ller</div>
                                                    <div>hat reagiert</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
            
                                    <!-- ========== Toolbar ========== -->
                                    <div class="toolBar">
                                        <div (click)="addReaction('approve')">
                                            <img src="/assets/img/main-chat/check_mark.svg">
                                        </div>
                                        <div (click)="addReaction('raisingHands')">
                                            <img src="/assets/img/main-chat/raising_hands.svg">
                                        </div>
                                        <div (click)="openMoreEmojis()">
                                            <span class="material-symbols-outlined">add_reaction</span>
                                        </div>
                                        <div (click)="openThread(thread.threadId)">
                                            <span class="material-symbols-outlined">comment</span>
                                        </div>
                                    </div>
            
                                </div>
                                <!-- ============================================================================ -->
                            } @else {
                                <!-- ========================= Template Own Message ========================= -->
                                <div class="messageContainerOwn">
                                    <div class="mainMessageOwn">
                                        <div>
                                            <div>{{thread.createdBy}}</div>
                                            <div>{{thread.time}} Uhr</div>
                                        </div>
                                        <div>
                                            {{thread.message}}
                                        </div>
                                        <div class="mainMessageThreadsOwn">
                                            <div>Letzte Antwort 14:56</div>
                                            <div (click)="openThread(thread.threadId)">1 Antworten</div>
                                        </div>
                                        <div class="mainThreadReactionsOwn">
                                            <div>
                                                <span class="material-symbols-outlined">add_reaction</span>
                                            </div>
                                            <div>
                                                <div class="ractionEmoji">
                                                     <img src="/assets/img/main-chat/rocketEmoji.svg">                                            </div>
                                                <div class="ractionCount">
                                                    <div>1</div>
                                                </div>
                                                <div class="reactionHoverBubble">
                                                    <div></div>
                                                    <div>Sofia MÃ¼ller</div>
                                                    <div>hat reagiert</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="messageProfileIcon">
                                        <img src="/assets/img/main-chat/member1.svg">
                                    </div>
            
                                    <!-- ========== Toolbar own ========== -->
                                    <div class="toolBarOwn">
                                        <div (click)="addReaction('approve')">
                                            <img src="/assets/img/main-chat/check_mark.svg">
                                        </div>
                                        <div (click)="addReaction('raisingHands')">
                                            <img src="/assets/img/main-chat/raising_hands.svg">
                                        </div>
                                        <div (click)="openMoreEmojis()">
                                            <span class="material-symbols-outlined">add_reaction</span>
                                        </div>
                                        <div (click)="openThread(thread.threadId)">
                                            <span class="material-symbols-outlined">comment</span>
                                        </div>
                                        <div (click)="moreOptions()">
                                            <span class="material-symbols-outlined">more_vert</span>
                                        </div>
                                    </div>
                                    <div *ngIf="editMessagePopupOpen" class="editMessagePopup">
                                        <div (click)="editMessage()">
                                            <div>Nachricht bearbeiten</div>
                                        </div>
                                    </div>
                                </div>
                                <!-- ========================= Template Own Message - EDIT ========================= -->
                                <div class="messageContainerOwnEdit" *ngIf="ownMessageEdit">
                                    <div class="mainMessageOwnEdit">
                                        <textarea name="textAreaEditMessage" [(ngModel)]="textAreaEditMessage"></textarea>
                                        <div>
                                            <div>
                                                <span class="material-symbols-outlined">sentiment_satisfied</span>
                                            </div>
                                            <div>
                                                <button (click)="closeEditedMessage()">Abbrechen</button>
                                                <button (click)="saveEditedMessage()">Speichern</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="messageProfileIcon">
                                        <img src="/assets/img/main-chat/member1.svg">
                                    </div>
                                </div>
                            }
                        }
                    }
                }
                                
<!--        </div> -->
<!--             <div hidden #endOfChat></div>
 -->        </div>
        <!-- =================================================================================================== -->

        <!-- ======================================== MAIN CHAT INPUT ========================================== -->
        <div class="mainChatInput">
            <div class="mainChatInputSubContainer">
                <textarea [(ngModel)]="textArea" name="textarea"
                    placeholder="Nachricht an #{{channel?.name}}"></textarea>
                <div>
                    <div>
                        <div>
                            <span class="material-symbols-outlined">add</span>
                        </div>
                        <div>
                            <img src="/assets/img/main-chat/separatingLine.svg">
                        </div>
                        <div>
                            <span class="material-symbols-outlined">sentiment_satisfied</span>
                        </div>
                        <div>
                            <span class="material-symbols-outlined">alternate_email</span>
                        </div>
                    </div>
                    <div (click)="sendMessage()">
                        <img src="/assets/img/main-chat/sendIconDefault.svg">
                    </div>
                </div>
            </div>
        </div>        
        <!-- =================================================================================================== -->

    </div>


    <app-secondary-chat *ngIf="threadOpen" (closeThreadEvent)="threadOpen = false"></app-secondary-chat>
</div>