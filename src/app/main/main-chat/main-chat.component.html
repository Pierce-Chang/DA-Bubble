<div (click)="closeDialog()" class="dialogBackground"
    *ngIf="addMemberDialogOpen || channelEditionDialogOpen || showMembersDialogOpen">
</div>

<div class="mainChatWrapper">
    <!--     <div class="mainChatContainer" [ngClass]="{'mainChatFullWidth': !threadOpen}"> -->
    <div class="mainChatContainer">
        <!-- ======================================== MAIN CHAT HEADER ========================================== -->
        @if(typeChannel) {
        <!-- =========== TEMPLATE MAIN CHAT HEADER - CHANNELS ============= -->
        <div class="mainChatHeader">
            <div class="mainChatHeaderLeft" (click)="toggleDialog('channelEdition')">
                <div>&#35;</div>
                <div>{{channel?.name}}</div>
                <div>
                    <mat-icon class="material-symbols-outlined" fontIcon="keyboard_arrow_down"></mat-icon>
                </div>
            </div>

            <div class="mainChatHeaderRight">
                <div (click)="toggleDialog('showMembers')">
                    <div class="memberPhotos">
                        @for (member of channel?.members | slice:0:3; track $index) {
                        <div>
                            <img src="/assets/img/main-chat/member2.svg">
                        </div>
                        }
                        <div *ngIf="channel?.members.length > 3">
                            <div>+{{channel?.members.length - 3}}</div>
                        </div>
                    </div>
                    <div>{{channel?.members.length}}</div>
                </div>
                <div (click)="toggleDialog('addMember'); scrollToBottom()" >
                    <span class="material-symbols-outlined">person_add</span>
                </div>
            </div>

            <!--========== Channel Edition/ Dialog ============-->
            <app-channel-edition-dialog [channelData]="channel" [currentChannelId]="activeChannelId" [channelMembers]="channelMembers" *ngIf="channelEditionDialogOpen"
                (channelEditionDialogOpenChild)="setBoolean(channelEditionDialogOpen)"></app-channel-edition-dialog>
            <!--=================================================-->

            <!--============== Show member Dialog ================-->
            <app-show-members-dialog [channelData]="channel" [currentChannelId]="activeChannelId" [channelMembers]="channelMembers" [currentUser]="currentUser" *ngIf="showMembersDialogOpen"
                (addMembersDialogOpenOpenChildShow)="switchToAddMembers(addMemberDialogOpen)"
                (showMembersDialogOpenChild)="setBoolean(showMembersDialogOpen)"></app-show-members-dialog>
            <!--=================================================-->

            <!--========== Add member Dialog ============-->
            <app-add-members-dialog [channelData]="channel" [currentChannelId]="activeChannelId"  *ngIf="addMemberDialogOpen"
                (addMemberDialogOpenChild)="setBoolean(addMemberDialogOpen)"></app-add-members-dialog>
            <!--=================================================-->
        </div>
        <!-- ================================================== -->
        } @else {
            <!-- =========== TEMPLATE MAIN CHAT HEADER - DM ============= -->
            <div class="mainChatHeader">
                <div class="mainChatHeaderLeft">
                    <div class="userImage">
                        <img src="/assets/img/main-chat/member2.svg">
    <!--                <div class="onlineStatus" [ngStyle]="{'background-color': member.isOnline ? '#92c83e' : '#686868' }"></div> -->
                        <div class="onlineStatus" [ngStyle]="{'background-color': '#92c83e'}"></div>
                    </div>
                    <div>Tobias Odermatt</div>
                </div>
            </div>
        }
        <!-- ===================================================================================================== -->

        <!-- ======================================== MAIN CHAT MESSAGES ========================================== -->
        <div class="mainChatMessages" #mainChat>
<!--        <div class="mainChatMessagesSubContainer"> -->            
                @if(typeChannel) {
                    <!-- =========== Template main chat beginning - Channel ============= -->
                    <div class="beginningOfChannel">
                        <div>
                            <div>&#35;</div>
                            <div>{{channel?.name}}</div>
                        </div>
                        <div>
                            Du hast den Channel heute erstellt. Das ist der Anfang des Channels <span
                                style="color: rgba(83, 90, 241, 1)">#{{channel?.name}}</span>
                        </div>
                    </div>
                    <!-- ================================================================ -->
                } @else {
                    <!-- =========== Template main chat beginning - DM ============= -->
    <!--                 <div class="beginningOfChannel">
                        <div>
                            <div>
                                <img [src]="channel[0].members[0].photo">
                            </div>
                            <div>{{channel[0].members[0].name}}</div>
                        </div>
                        <div>
                            Diese Unterhaltung findet nur zwischen <span
                                style="color: rgba(83, 90, 241, 1)">&#64;{{channels[0].members[0].name}}
                                {{channels[0].members[0].surname}}</span> und dir statt.
                        </div>
                    </div> -->
                    <!-- ================================================================ -->
                }

                <!-- =================== Time separator / Threads ===================== -->
                @for (threadTimeSeparator of threadCreationDates; track $index) {
                    <div class="timeSeparator">
                        <div>
                            <div>{{threadTimeSeparator.timeSeparatorDate}}</div>
                        </div>
                    </div>
                    @for (thread of channelThreadsDateTime; track $index) {
                        @if(thread.dateString == threadTimeSeparator.dateString) {
                            <app-thread [activeChannelId]="activeChannelId" [thread]="thread" [currentUser]="currentUser"></app-thread>
                        }
                    }
                }           
        </div>
        <!-- =================================================================================================== -->

        <!-- ======================================== MAIN CHAT INPUT ========================================== -->

        <div class="mainChatInput">
            <app-text-box [messageType]="'channel'" [targetId]="'allgemein'"></app-text-box>
<!--             <div class="mainChatInputSubContainer">
                <textarea [(ngModel)]="textArea" name="textarea"
                    placeholder="Nachricht an #{{channel?.name}}"></textarea>
                <div>
                    <div>
                        <div>
                            <span class="material-symbols-outlined">add</span>
                        </div>
                        <div>
                            <img src="/assets/img/main-chat/separatingLine.svg">
                        </div>
                        <div>
                            <span class="material-symbols-outlined">sentiment_satisfied</span>
                        </div>
                        <div>
                            <span class="material-symbols-outlined">alternate_email</span>
                        </div>
                    </div>
                    <div (click)="sendMessage()">
                        <img src="/assets/img/main-chat/sendIconDefault.svg">
                    </div>
                </div>
            </div>
 -->    </div>        
        <!-- =================================================================================================== -->
    </div>
    <app-secondary-chat *ngIf="threadOpen" (closeThreadEvent)="threadOpen = false"></app-secondary-chat>
</div>